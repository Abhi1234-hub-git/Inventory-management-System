<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexGen Retail Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: var(--dark-color);
        }
        
        .sidebar {
            background-color: var(--secondary-color);
            color: white;
            height: 100vh;
            position: fixed;
            padding-top: 20px;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 5px;
            border-radius: 5px;
            padding: 10px 15px;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            margin-bottom: 20px;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-danger {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        
        .stat-card .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-card .stat-label {
            color: var(--secondary-color);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
        }
        
        .table {
            margin-bottom: 0;
        }
        
        .table th {
            background-color: var(--light-color);
            color: var(--dark-color);
        }
        
        .action-btns .btn {
            padding: 5px 10px;
            margin-right: 5px;
        }
        
        .modal-content {
            border-radius: 10px;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block sidebar collapse bg-dark">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4>NexGen Retail</h4>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" id="dashboard-link">
                                <i class="bi bi-speedometer2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="products-link">
                                <i class="bi bi-box-seam"></i> Products
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="customers-link">
                                <i class="bi bi-people"></i> Customers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="transactions-link">
                                <i class="bi bi-cash-stack"></i> Transactions
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="employees-link">
                                <i class="bi bi-person-badge"></i> Employees
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="reports-link">
                                <i class="bi bi-graph-up"></i> Reports
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <!-- Dashboard Content -->
                <div id="dashboard-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Dashboard</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <div class="btn-group me-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
                                <span data-feather="calendar"></span> This week
                            </button>
                        </div>
                    </div>

                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="stat-value" id="total-products">0</div>
                                <div class="stat-label">Total Products</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="stat-value" id="total-customers">0</div>
                                <div class="stat-label">Total Customers</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="stat-value" id="total-sales">$0</div>
                                <div class="stat-label">Total Sales</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card stat-card">
                                <div class="stat-value" id="total-transactions">0</div>
                                <div class="stat-label">Transactions</div>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    Recent Transactions
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="recent-transactions">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Amount</th>
                                                    <th>Date</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Filled by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    Top Products
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="top-products">
                                            <thead>
                                                <tr>
                                                    <th>Product</th>
                                                    <th>Category</th>
                                                    <th>Sales</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Filled by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Products Content -->
                <div id="products-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Products Management</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
                                <i class="bi bi-plus-circle"></i> Add Product
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            Product List
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="products-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Brand</th>
                                            <th>Category</th>
                                            <th>Price</th>
                                            <th>Stock</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customers Content -->
                <div id="customers-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Customers Management</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCustomerModal">
                                <i class="bi bi-plus-circle"></i> Add Customer
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            Customer List
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="customers-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Name</th>
                                            <th>Email</th>
                                            <th>Phone</th>
                                            <th>Registered</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transactions Content -->
                <div id="transactions-content" style="display: none;">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Transactions</h1>
                        <div class="btn-toolbar mb-2 mb-md-0">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newTransactionModal">
                                <i class="bi bi-plus-circle"></i> New Transaction
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            Transaction History
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="transactions-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Date</th>
                                            <th>Customer</th>
                                            <th>Amount</th>
                                            <th>Payment</th>
                                            <th>Status</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Filled by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductModalLabel">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <input type="hidden" id="productId" value="">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="productName" class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="productName" required>
                            </div>
                            <div class="col-md-6">
                                <label for="productBrand" class="form-label">Brand</label>
                                <select class="form-select" id="productBrand" required>
                                    <option value="">Select Brand</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="productCategory" class="form-label">Category</label>
                                <select class="form-select" id="productCategory" required>
                                    <option value="">Select Category</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="productStore" class="form-label">Store</label>
                                <select class="form-select" id="productStore" required>
                                    <option value="">Select Store</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="productPrice" class="form-label">Price</label>
                                <input type="number" class="form-control" id="productPrice" required>
                            </div>
                            <div class="col-md-4">
                                <label for="productStock" class="form-label">Stock</label>
                                <input type="number" class="form-control" id="productStock" required>
                            </div>
                            <div class="col-md-4">
                                <label for="productDate" class="form-label">Added Date</label>
                                <input type="date" class="form-control" id="productDate" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveProductBtn">Save Product</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div class="modal fade" id="addCustomerModal" tabindex="-1" aria-labelledby="addCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCustomerModalLabel">Add New Customer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="customerForm">
                        <input type="hidden" id="customerId" value="">
                        <div class="mb-3">
                            <label for="customerName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="customerEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="customerEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="customerPhone" class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" id="customerPhone" required>
                        </div>
                        <div class="mb-3">
                            <label for="customerAddress" class="form-label">Address</label>
                            <textarea class="form-control" id="customerAddress" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="customerDate" class="form-label">Registration Date</label>
                            <input type="date" class="form-control" id="customerDate" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveCustomerBtn">Save Customer</button>
                </div>
            </div>
        </div>
    </div>

    <!-- New Transaction Modal -->
    <div class="modal fade" id="newTransactionModal" tabindex="-1" aria-labelledby="newTransactionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newTransactionModalLabel">New Transaction</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="transactionForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="transactionCustomer" class="form-label">Customer</label>
                                <select class="form-select" id="transactionCustomer" required>
                                    <option value="">Select Customer</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="transactionDate" class="form-label">Date</label>
                                <input type="datetime-local" class="form-control" id="transactionDate" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Products</label>
                            <div class="input-group mb-3">
                                <select class="form-select" id="transactionProduct">
                                    <option value="">Select Product</option>
                                </select>
                                <input type="number" class="form-control" id="transactionQuantity" placeholder="Qty" min="1" value="1">
                                <button class="btn btn-primary" type="button" id="addProductBtn">Add</button>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table" id="transactionProductsTable">
                                    <thead>
                                        <tr>
                                            <th>Product</th>
                                            <th>Price</th>
                                            <th>Qty</th>
                                            <th>Total</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Products will be added here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="transactionSubtotal" class="form-label">Subtotal</label>
                                <input type="text" class="form-control" id="transactionSubtotal" readonly>
                            </div>
                            <div class="col-md-4">
                                <label for="transactionDiscount" class="form-label">Discount</label>
                                <input type="number" class="form-control" id="transactionDiscount" value="0" min="0">
                            </div>
                            <div class="col-md-4">
                                <label for="transactionTax" class="form-label">Tax (GST)</label>
                                <input type="text" class="form-control" id="transactionTax" readonly>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="transactionTotal" class="form-label">Total Amount</label>
                                <input type="text" class="form-control" id="transactionTotal" readonly>
                            </div>
                            <div class="col-md-6">
                                <label for="transactionPaymentMethod" class="form-label">Payment Method</label>
                                <select class="form-select" id="transactionPaymentMethod" required>
                                    <option value="cash">Cash</option>
                                    <option value="card">Card</option>
                                    <option value="upi">UPI</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="transactionPaid" class="form-label">Amount Paid</label>
                                <input type="number" class="form-control" id="transactionPaid" required>
                            </div>
                            <div class="col-md-6">
                                <label for="transactionDue" class="form-label">Amount Due</label>
                                <input type="text" class="form-control" id="transactionDue" readonly>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="completeTransactionBtn">Complete Transaction</button>
                </div>
            </div>
        </div>
    </div>

    <!-- View Transaction Modal -->
    <div class="modal fade" id="viewTransactionModal" tabindex="-1" aria-labelledby="viewTransactionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewTransactionModalLabel">Transaction Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <p><strong>Transaction ID:</strong> <span id="viewTransactionId"></span></p>
                            <p><strong>Date:</strong> <span id="viewTransactionDate"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Customer:</strong> <span id="viewTransactionCustomer"></span></p>
                            <p><strong>Payment Method:</strong> <span id="viewTransactionPayment"></span></p>
                        </div>
                    </div>
                    
                    <div class="table-responsive mb-3">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Product</th>
                                    <th>Price</th>
                                    <th>Qty</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="viewTransactionProducts">
                                <!-- Products will be added here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 offset-md-6">
                            <table class="table">
                                <tr>
                                    <th>Subtotal:</th>
                                    <td id="viewTransactionSubtotal"></td>
                                </tr>
                                <tr>
                                    <th>Discount:</th>
                                    <td id="viewTransactionDiscount"></td>
                                </tr>
                                <tr>
                                    <th>Tax (GST):</th>
                                    <td id="viewTransactionTax"></td>
                                </tr>
                                <tr class="table-active">
                                    <th>Total:</th>
                                    <td id="viewTransactionTotal"></td>
                                </tr>
                                <tr>
                                    <th>Amount Paid:</th>
                                    <td id="viewTransactionPaid"></td>
                                </tr>
                                <tr>
                                    <th>Amount Due:</th>
                                    <td id="viewTransactionDue"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="printTransactionBtn">Print Invoice</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmationModalLabel">Confirm Action</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p id="confirmationMessage">Are you sure you want to perform this action?</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmActionBtn">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Global variables
        let currentAction = '';
        let currentId = '';
        let transactionProducts = [];
        
        // Document ready
        document.addEventListener('DOMContentLoaded', function() {
            // Load dashboard data
            loadDashboardData();
            
            // Load dropdown data
            loadDropdownData();
            
            // Load products table
            loadProductsTable();
            
            // Load customers table
            loadCustomersTable();
            
            // Load transactions table
            loadTransactionsTable();
            
            // Navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Hide all content sections
                    document.querySelectorAll('.main-content > div').forEach(section => {
                        section.style.display = 'none';
                    });
                    
                    // Remove active class from all links
                    document.querySelectorAll('.nav-link').forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    
                    // Add active class to clicked link
                    this.classList.add('active');
                    
                    // Show corresponding content section
                    const target = this.id.replace('-link', '-content');
                    document.getElementById(target).style.display = 'block';
                });
            });
            
            // Product form submission
            document.getElementById('saveProductBtn').addEventListener('click', function() {
                saveProduct();
            });
            
            // Customer form submission
            document.getElementById('saveCustomerBtn').addEventListener('click', function() {
                saveCustomer();
            });
            
            // Transaction product addition
            document.getElementById('addProductBtn').addEventListener('click', function() {
                addProductToTransaction();
            });
            
            // Complete transaction
            document.getElementById('completeTransactionBtn').addEventListener('click', function() {
                completeTransaction();
            });
            
            // Print transaction
            document.getElementById('printTransactionBtn').addEventListener('click', function() {
                printTransaction();
            });
            
            // Transaction amount calculations
            document.getElementById('transactionDiscount').addEventListener('change', calculateTransactionTotals);
            document.getElementById('transactionPaid').addEventListener('change', calculateTransactionTotals);
            
            // Confirmation modal
            document.getElementById('confirmActionBtn').addEventListener('click', function() {
                if (currentAction === 'deleteProduct') {
                    deleteProduct(currentId);
                } else if (currentAction === 'deleteCustomer') {
                    deleteCustomer(currentId);
                } else if (currentAction === 'deleteTransaction') {
                    deleteTransaction(currentId);
                }
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('confirmationModal'));
                modal.hide();
            });
        });
        
        // Load dashboard data
        function loadDashboardData() {
            fetch('api.php?action=dashboard')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('total-products').textContent = data.total_products;
                        document.getElementById('total-customers').textContent = data.total_customers;
                        document.getElementById('total-sales').textContent = '$' + data.total_sales;
                        document.getElementById('total-transactions').textContent = data.total_transactions;
                        
                        // Recent transactions
                        const transactionsTable = document.getElementById('recent-transactions').getElementsByTagName('tbody')[0];
                        transactionsTable.innerHTML = '';
                        
                        data.recent_transactions.forEach(transaction => {
                            const row = transactionsTable.insertRow();
                            row.innerHTML = `
                                <td>${transaction.id}</td>
                                <td>$${transaction.total_amount}</td>
                                <td>${transaction.date}</td>
                                <td><span class="badge bg-${transaction.due > 0 ? 'warning' : 'success'}">${transaction.due > 0 ? 'Pending' : 'Completed'}</span></td>
                            `;
                        });
                        
                        // Top products
                        const productsTable = document.getElementById('top-products').getElementsByTagName('tbody')[0];
                        productsTable.innerHTML = '';
                        
                        data.top_products.forEach(product => {
                            const row = productsTable.insertRow();
                            row.innerHTML = `
                                <td>${product.pname}</td>
                                <td>${product.category_name}</td>
                                <td>$${product.total_sales}</td>
                            `;
                        });
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        // Load dropdown data
        function loadDropdownData() {
            // Load brands
            fetch('api.php?action=getBrands')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const brandSelect = document.getElementById('productBrand');
                        brandSelect.innerHTML = '<option value="">Select Brand</option>';
                        
                        data.brands.forEach(brand => {
                            const option = document.createElement('option');
                            option.value = brand.bid;
                            option.textContent = brand.brandname;
                            brandSelect.appendChild(option);
                        });
                    }
                });
            
            // Load categories
            fetch('api.php?action=getCategories')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const categorySelect = document.getElementById('productCategory');
                        categorySelect.innerHTML = '<option value="">Select Category</option>';
                        
                        data.categories.forEach(category => {
                            const option = document.createElement('option');
                            option.value = category.cid;
                            option.textContent = category.category_name;
                            categorySelect.appendChild(option);
                        });
                    }
                });
            
            // Load stores
            fetch('api.php?action=getStores')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const storeSelect = document.getElementById('productStore');
                        storeSelect.innerHTML = '<option value="">Select Store</option>';
                        
                        data.stores.forEach(store => {
                            const option = document.createElement('option');
                            option.value = store.sid;
                            option.textContent = store.sname;
                            storeSelect.appendChild(option);
                        });
                    }
                });
            
            // Load customers for transaction
            fetch('api.php?action=getCustomers')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const customerSelect = document.getElementById('transactionCustomer');
                        customerSelect.innerHTML = '<option value="">Select Customer</option>';
                        
                        data.customers.forEach(customer => {
                            const option = document.createElement('option');
                            option.value = customer.customer_id;
                            option.textContent = customer.name;
                            customerSelect.appendChild(option);
                        });
                    }
                });
            
            // Load products for transaction
            fetch('api.php?action=getProducts')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const productSelect = document.getElementById('transactionProduct');
                        productSelect.innerHTML = '<option value="">Select Product</option>';
                        
                        data.products.forEach(product => {
                            const option = document.createElement('option');
                            option.value = product.pid;
                            option.textContent = `${product.pname} ($${product.price}) - ${product.brandname}`;
                            option.dataset.price = product.price;
                            option.dataset.name = product.pname;
                            productSelect.appendChild(option);
                        });
                    }
                });
        }
        
        // Load products table
        function loadProductsTable() {
            fetch('api.php?action=getProducts')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const table = document.getElementById('products-table').getElementsByTagName('tbody')[0];
                        table.innerHTML = '';
                        
                        data.products.forEach(product => {
                            const row = table.insertRow();
                            row.innerHTML = `
                                <td>${product.pid}</td>
                                <td>${product.pname}</td>
                                <td>${product.brandname}</td>
                                <td>${product.category_name}</td>
                                <td>$${product.price}</td>
                                <td>${product.p_stock}</td>
                                <td class="action-btns">
                                    <button class="btn btn-sm btn-primary edit-product" data-id="${product.pid}">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger delete-product" data-id="${product.pid}">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            `;
                        });
                        
                        // Add event listeners to edit buttons
                        document.querySelectorAll('.edit-product').forEach(button => {
                            button.addEventListener('click', function() {
                                editProduct(this.dataset.id);
                            });
                        });
                        
                        // Add event listeners to delete buttons
                        document.querySelectorAll('.delete-product').forEach(button => {
                            button.addEventListener('click', function() {
                                showConfirmation('deleteProduct', this.dataset.id, 'Are you sure you want to delete this product?');
                            });
                        });
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        // Load customers table
        function loadCustomersTable() {
            fetch('api.php?action=getCustomers')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const table = document.getElementById('customers-table').getElementsByTagName('tbody')[0];
                        table.innerHTML = '';
                        
                        data.customers.forEach(customer => {
                            const row = table.insertRow();
                            row.innerHTML = `
                                <td>${customer.customer_id}</td>
                                <td>${customer.name}</td>
                                <td>${customer.email}</td>
                                <td>${customer.phone_number}</td>
                                <td>${customer.registration_date}</td>
                                <td class="action-btns">
                                    <button class="btn btn-sm btn-primary edit-customer" data-id="${customer.customer_id}">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger delete-customer" data-id="${customer.customer_id}">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            `;
                        });
                        
                        // Add event listeners to edit buttons
                        document.querySelectorAll('.edit-customer').forEach(button => {
                            button.addEventListener('click', function() {
                                editCustomer(this.dataset.id);
                            });
                        });
                        
                        // Add event listeners to delete buttons
                        document.querySelectorAll('.delete-customer').forEach(button => {
                            button.addEventListener('click', function() {
                                showConfirmation('deleteCustomer', this.dataset.id, 'Are you sure you want to delete this customer?');
                            });
                        });
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        // Load transactions table
        function loadTransactionsTable() {
            fetch('api.php?action=getTransactions')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const table = document.getElementById('transactions-table').getElementsByTagName('tbody')[0];
                        table.innerHTML = '';
                        
                        data.transactions.forEach(transaction => {
                            const row = table.insertRow();
                            row.innerHTML = `
                                <td>${transaction.id}</td>
                                <td>${transaction.date}</td>
                                <td>${transaction.customer_name || 'N/A'}</td>
                                <td>$${transaction.total_amount}</td>
                                <td>${transaction.payment_method.toUpperCase()}</td>
                                <td><span class="badge bg-${transaction.due > 0 ? 'warning' : 'success'}">${transaction.due > 0 ? 'Pending' : 'Completed'}</span></td>
                                <td class="action-btns">
                                    <button class="btn btn-sm btn-primary view-transaction" data-id="${transaction.id}">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger delete-transaction" data-id="${transaction.id}">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            `;
                        });
                        
                        // Add event listeners to view buttons
                        document.querySelectorAll('.view-transaction').forEach(button => {
                            button.addEventListener('click', function() {
                                viewTransaction(this.dataset.id);
                            });
                        });
                        
                        // Add event listeners to delete buttons
                        document.querySelectorAll('.delete-transaction').forEach(button => {
                            button.addEventListener('click', function() {
                                showConfirmation('deleteTransaction', this.dataset.id, 'Are you sure you want to delete this transaction?');
                            });
                        });
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        // Edit product
        function editProduct(id) {
            fetch(`api.php?action=getProduct&id=${id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const product = data.product;
                        
                        document.getElementById('productId').value = product.pid;
                        document.getElementById('productName').value = product.pname;
                        document.getElementById('productBrand').value = product.bid;
                        document.getElementById('productCategory').value = product.cid;
                        document.getElementById('productStore').value = product.sid;
                        document.getElementById('productPrice').value = product.price;
                        document.getElementById('productStock').value = product.p_stock;
                        document.getElementById('productDate').value = product.added_date;
                        
                        const modal = new bootstrap.Modal(document.getElementById('addProductModal'));
                        modal.show();
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        // Save product
        function saveProduct() {
            const productId = document.getElementById('productId').value;
            const productData = {
                pname: document.getElementById('productName').value,
                bid: document.getElementById('productBrand').value,
                cid: document.getElementById('productCategory').value,
                sid: document.getElementById('productStore').value,
                price: document.getElementById('productPrice').value,
                p_stock: document.getElementById('productStock').value,
                added_date: document.getElementById('productDate').value
            };
            
            const url = productId ? `api.php?action=updateProduct&id=${productId}` : 'api.php?action=addProduct';
            const method = productId ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(productData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addProductModal'));
                    modal.hide();
                    
                    // Reset form
                    document.getElementById('productForm').reset();
                    document.getElementById('productId').value = '';
                    
                    // Reload products table
                    loadProductsTable();
                    
                    // Show success message
                    alert('Product saved successfully!');
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        // Delete product
        function deleteProduct(id) {
            fetch(`api.php?action=deleteProduct&id=${id}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Reload products table
                    loadProductsTable();
                    
                    // Show success message
                    alert('Product deleted successfully!');
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        // Edit customer
        function editCustomer(id) {
            fetch(`api.php?action=getCustomer&id=${id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const customer = data.customer;
                        
                        document.getElementById('customerId').value = customer.customer_id;
                        document.getElementById('customerName').value = customer.name;
                        document.getElementById('customerEmail').value = customer.email;
                        document.getElementById('customerPhone').value = customer.phone_number;
                        document.getElementById('customerAddress').value = customer.address;
                        document.getElementById('customerDate').value = customer.registration_date;
                        
                        const modal = new bootstrap.Modal(document.getElementById('addCustomerModal'));
                        modal.show();
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        // Save customer
        function saveCustomer() {
            const customerId = document.getElementById('customerId').value;
            const customerData = {
                name: document.getElementById('customerName').value,
                email: document.getElementById('customerEmail').value,
                phone_number: document.getElementById('customerPhone').value,
                address: document.getElementById('customerAddress').value,
                registration_date: document.getElementById('customerDate').value
            };
            
            const url = customerId ? `api.php?action=updateCustomer&id=${customerId}` : 'api.php?action=addCustomer';
            const method = customerId ? 'PUT' : 'POST';
            
            fetch(url, {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(customerData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addCustomerModal'));
                    modal.hide();
                    
                    // Reset form
                    document.getElementById('customerForm').reset();
                    document.getElementById('customerId').value = '';
                    
                    // Reload customers table
                    loadCustomersTable();
                    
                    // Show success message
                    alert('Customer saved successfully!');
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        // Delete customer
        function deleteCustomer(id) {
            fetch(`api.php?action=deleteCustomer&id=${id}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Reload customers table
                    loadCustomersTable();
                    
                    // Show success message
                    alert('Customer deleted successfully!');
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        // Add product to transaction
        function addProductToTransaction() {
            const productSelect = document.getElementById('transactionProduct');
            const quantityInput = document.getElementById('transactionQuantity');
            
            if (!productSelect.value || !quantityInput.value || quantityInput.value < 1) {
                alert('Please select a product and enter a valid quantity');
                return;
            }
            
            const productId = productSelect.value;
            const productName = productSelect.options[productSelect.selectedIndex].dataset.name;
            const price = parseFloat(productSelect.options[productSelect.selectedIndex].dataset.price);
            const quantity = parseInt(quantityInput.value);
            
            // Check if product already exists in transaction
            const existingProductIndex = transactionProducts.findIndex(p => p.id === productId);
            
            if (existingProductIndex >= 0) {
                // Update quantity
                transactionProducts[existingProductIndex].quantity += quantity;
            } else {
                // Add new product
                transactionProducts.push({
                    id: productId,
                    name: productName,
                    price: price,
                    quantity: quantity
                });
            }
            
            // Update transaction products table
            updateTransactionProductsTable();
            
            // Reset inputs
            productSelect.value = '';
            quantityInput.value = 1;
            
            // Calculate totals
            calculateTransactionTotals();
        }
        
        // Update transaction products table
        function updateTransactionProductsTable() {
            const table = document.getElementById('transactionProductsTable').getElementsByTagName('tbody')[0];
            table.innerHTML = '';
            
            transactionProducts.forEach((product, index) => {
                const row = table.insertRow();
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>$${product.price.toFixed(2)}</td>
                    <td>${product.quantity}</td>
                    <td>$${(product.price * product.quantity).toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-danger remove-product" data-index="${index}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
            });
            
            // Add event listeners to remove buttons
            document.querySelectorAll('.remove-product').forEach(button => {
                button.addEventListener('click', function() {
                    transactionProducts.splice(parseInt(this.dataset.index), 1);
                    updateTransactionProductsTable();
                    calculateTransactionTotals();
                });
            });
        }
        
        // Calculate transaction totals
        function calculateTransactionTotals() {
            if (transactionProducts.length === 0) {
                document.getElementById('transactionSubtotal').value = '0.00';
                document.getElementById('transactionTax').value = '0.00';
                document.getElementById('transactionTotal').value = '0.00';
                document.getElementById('transactionDue').value = '0.00';
                return;
            }
            
            const subtotal = transactionProducts.reduce((sum, product) => sum + (product.price * product.quantity), 0);
            const discount = parseFloat(document.getElementById('transactionDiscount').value) || 0;
            const tax = (subtotal - discount) * 0.1; // Assuming 10% GST
            const total = subtotal - discount + tax;
            const paid = parseFloat(document.getElementById('transactionPaid').value) || 0;
            const due = total - paid;
            
            document.getElementById('transactionSubtotal').value = subtotal.toFixed(2);
            document.getElementById('transactionTax').value = tax.toFixed(2);
            document.getElementById('transactionTotal').value = total.toFixed(2);
            document.getElementById('transactionDue').value = due.toFixed(2);
        }
        
        // Complete transaction
        function completeTransaction() {
            const customerId = document.getElementById('transactionCustomer').value;
            const transactionDate = document.getElementById('transactionDate').value;
            const paymentMethod = document.getElementById('transactionPaymentMethod').value;
            const subtotal = parseFloat(document.getElementById('transactionSubtotal').value) || 0;
            const discount = parseFloat(document.getElementById('transactionDiscount').value) || 0;
            const tax = parseFloat(document.getElementById('transactionTax').value) || 0;
            const total = parseFloat(document.getElementById('transactionTotal').value) || 0;
            const paid = parseFloat(document.getElementById('transactionPaid').value) || 0;
            const due = parseFloat(document.getElementById('transactionDue').value) || 0;
            
            if (!customerId) {
                alert('Please select a customer');
                return;
            }
            
            if (transactionProducts.length === 0) {
                alert('Please add at least one product to the transaction');
                return;
            }
            
            if (paid <= 0) {
                alert('Please enter the amount paid');
                return;
            }
            
            const transactionData = {
                customer_id: customerId,
                transaction_date: transactionDate,
                payment_method: paymentMethod,
                subtotal: subtotal,
                discount: discount,
                tax: tax,
                total: total,
                paid: paid,
                due: due,
                products: transactionProducts
            };
            
            fetch('api.php?action=addTransaction', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(transactionData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('newTransactionModal'));
                    modal.hide();
                    
                    // Reset form
                    document.getElementById('transactionForm').reset();
                    transactionProducts = [];
                    updateTransactionProductsTable();
                    calculateTransactionTotals();
                    
                    // Reload transactions table
                    loadTransactionsTable();
                    
                    // Show success message
                    alert('Transaction completed successfully!');
                    
                    // View the new transaction
                    viewTransaction(data.transaction_id);
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        // View transaction
        function viewTransaction(id) {
            fetch(`api.php?action=getTransaction&id=${id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const transaction = data.transaction;
                        
                        document.getElementById('viewTransactionId').textContent = transaction.id;
                        document.getElementById('viewTransactionDate').textContent = transaction.date;
                        document.getElementById('viewTransactionCustomer').textContent = transaction.customer_name || 'N/A';
                        document.getElementById('viewTransactionPayment').textContent = transaction.payment_method.toUpperCase();
                        
                        // Products
                        const productsTable = document.getElementById('viewTransactionProducts');
                        productsTable.innerHTML = '';
                        
                        transaction.products.forEach(product => {
                            const row = productsTable.insertRow();
                            row.innerHTML = `
                                <td>${product.pname}</td>
                                <td>$${product.price.toFixed(2)}</td>
                                <td>${product.quantity}</td>
                                <td>$${(product.price * product.quantity).toFixed(2)}</td>
                            `;
                        });
                        
                        // Totals
                        document.getElementById('viewTransactionSubtotal').textContent = '$' + transaction.subtotal.toFixed(2);
                        document.getElementById('viewTransactionDiscount').textContent = '$' + transaction.discount.toFixed(2);
                        document.getElementById('viewTransactionTax').textContent = '$' + transaction.tax.toFixed(2);
                        document.getElementById('viewTransactionTotal').textContent = '$' + transaction.total.toFixed(2);
                        document.getElementById('viewTransactionPaid').textContent = '$' + transaction.paid.toFixed(2);
                        document.getElementById('viewTransactionDue').textContent = '$' + transaction.due.toFixed(2);
                        
                        // Show modal
                        const modal = new bootstrap.Modal(document.getElementById('viewTransactionModal'));
                        modal.show();
                    }
                })
                .catch(error => console.error('Error:', error));
        }
        
        // Print transaction
        function printTransaction() {
            // In a real application, this would open a print-friendly version of the invoice
            alert('Printing functionality would be implemented here');
        }
        
        // Delete transaction
        function deleteTransaction(id) {
            fetch(`api.php?action=deleteTransaction&id=${id}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Reload transactions table
                    loadTransactionsTable();
                    
                    // Show success message
                    alert('Transaction deleted successfully!');
                } else {
                    alert('Error: ' + data.message);
                }
            })
            .catch(error => console.error('Error:', error));
        }
        
        // Show confirmation dialog
        function showConfirmation(action, id, message) {
            currentAction = action;
            currentId = id;
            
            document.getElementById('confirmationMessage').textContent = message;
            
            const modal = new bootstrap.Modal(document.getElementById('confirmationModal'));
            modal.show();
        }
    </script>
</body>
</html>